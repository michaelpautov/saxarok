import { readFile, writeFile, mkdir } from 'node:fs/promises';
import { existsSync } from 'node:fs';
import { join, dirname } from 'node:path';
import type { PromptsFile, Prompt, ActivePrompt, DialogFile } from '../types/index.js';

const DATA_DIR = join(process.cwd(), 'data');
const PROMPTS_DIR = join(DATA_DIR, 'prompts');
const DIALOGS_DIR = join(DATA_DIR, 'dialogs');

const PROMPTS_FILE = join(PROMPTS_DIR, 'prompts.json');
const ACTIVE_PROMPT_FILE = join(PROMPTS_DIR, 'active.json');

/**
 * Ensures a directory exists, creating it if necessary
 */
async function ensureDir(path: string): Promise<void> {
  if (!existsSync(path)) {
    await mkdir(path, { recursive: true });
  }
}

/**
 * Safely reads and parses a JSON file
 */
async function readJSON<T>(filePath: string, defaultValue: T): Promise<T> {
  try {
    const content = await readFile(filePath, 'utf-8');
    return JSON.parse(content) as T;
  } catch (error) {
    if ((error as NodeJS.ErrnoException).code === 'ENOENT') {
      return defaultValue;
    }
    throw error;
  }
}

/**
 * Safely writes JSON to a file with atomic operation
 */
async function writeJSON<T>(filePath: string, data: T): Promise<void> {
  await ensureDir(dirname(filePath));
  const content = JSON.stringify(data, null, 2);
  const tempPath = `${filePath}.tmp`;

  // Write to temp file first
  await writeFile(tempPath, content, 'utf-8');

  // Rename atomically
  await writeFile(filePath, content, 'utf-8');
}

// ==================== Prompts ====================

/**
 * Loads all prompts from storage
 */
export async function loadPrompts(): Promise<Prompt[]> {
  const data = await readJSON<PromptsFile>(PROMPTS_FILE, { prompts: [] });
  return data.prompts;
}

/**
 * Saves prompts to storage
 */
export async function savePrompts(prompts: Prompt[]): Promise<void> {
  await writeJSON<PromptsFile>(PROMPTS_FILE, { prompts });
}

/**
 * Gets the currently active prompt ID
 */
export async function getActivePromptId(): Promise<string | null> {
  const data = await readJSON<ActivePrompt>(ACTIVE_PROMPT_FILE, { activeId: '' });
  return data.activeId || null;
}

/**
 * Sets the active prompt ID
 */
export async function setActivePromptId(promptId: string): Promise<void> {
  await writeJSON<ActivePrompt>(ACTIVE_PROMPT_FILE, { activeId: promptId });
}

// ==================== Dialog History ====================

/**
 * Gets the path to a user's dialog file
 */
function getDialogFilePath(userId: string): string {
  return join(DIALOGS_DIR, `${userId}.json`);
}

/**
 * Loads dialog history for a user
 */
export async function loadDialog(userId: string): Promise<DialogFile | null> {
  const filePath = getDialogFilePath(userId);
  const defaultValue: DialogFile = {
    userId,
    username: '',
    messages: [],
    lastCleanup: new Date().toISOString(),
  };

  const dialog = await readJSON<DialogFile>(filePath, defaultValue);

  // If we got the default value, return null to indicate no existing dialog
  if (dialog.messages.length === 0 && !existsSync(filePath)) {
    return null;
  }

  return dialog;
}

/**
 * Saves dialog history for a user
 */
export async function saveDialog(dialog: DialogFile): Promise<void> {
  const filePath = getDialogFilePath(dialog.userId);
  await writeJSON<DialogFile>(filePath, dialog);
}

/**
 * Lists all user IDs that have dialog history
 */
export async function listDialogUsers(): Promise<string[]> {
  await ensureDir(DIALOGS_DIR);
  const { readdir } = await import('node:fs/promises');
  const files = await readdir(DIALOGS_DIR);

  return files.filter((f) => f.endsWith('.json')).map((f) => f.replace('.json', ''));
}

/**
 * Initializes default prompt if no prompts exist
 */
export async function initializeDefaultPrompt(): Promise<void> {
  const prompts = await loadPrompts();

  if (prompts.length === 0) {
    console.log('No prompts found. Creating default prompt...');

    const defaultPrompt: Prompt = {
      id: crypto.randomUUID(),
      name: '–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–º–ø—Ç (—à—É–≥–∞—Ä–∏–Ω–≥)',
      content: `–°–ò–°–¢–ï–ú–ù–ê–Ø –†–û–õ–¨
–í—ã ‚Äî –ª–∏—á–Ω—ã–π —Ç—å—é—Ç–æ—Ä –∏ –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ —à—É–≥–∞—Ä–∏–Ω–≥–∞ –≤ –æ—Ñ–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å–µ.
–í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ —Ç–æ–ª—å–∫–æ –æ–±—É—á–∞—Ç—å —à–∞–≥–∞–º –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, –Ω–æ –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ: —É–º–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –ì–æ—Å—Ç—å—é, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –∑–∞–±–æ—Ç—ã –∏ –¥–æ–≤–µ—Ä–∏—è. –≠—Ç–æ –≤–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–∞—Å—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ä—É–∫–∞–º–∏, –Ω–æ –∏ –≥–æ–ª–æ—Å–æ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º, —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω—ã–º –æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º–∞.
–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è: —Å–ø–æ–∫–æ–π–Ω—ã–π, –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π; –ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞; —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–µ ¬´–í—ã¬ª.

–¶–ï–õ–¨ –ò –†–ï–ó–£–õ–¨–¢–ê–¢
–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —É –º–∞—Å—Ç–µ—Ä–∞ —É—Å—Ç–æ–π—á–∏–≤—ã–µ –Ω–∞–≤—ã–∫–∏: –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, ¬´–¥–æ—Ä–æ–∂–∫–∞ –æ–∂–∏–¥–∞–Ω–∏–π¬ª, —Ç–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, –≥—Ä–∞–Ω–∏—Ü—ã, —Ä–∞–±–æ—Ç–∞ —Å –æ–ø–æ–∑–¥–∞–Ω–∏—è–º–∏, –¥–æ–ø.–∑–æ–Ω–∞–º–∏, –æ—Ç–∫–∞–∑ –ø–æ –º–µ–¥.–ø–æ–∫–∞–∑–∞–Ω–∏—è–º, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —É—Ö–æ–¥—É (–¥–æ/–ø–æ—Å–ª–µ/–º–µ–∂–¥—É).
–û–±—É—á–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –ë–∏—à–∫–µ–∫, –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω: –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å, —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è, –º—è–≥–∫–∏–π —Ç–æ–Ω, —É–º–µ–Ω–∏–µ ¬´—á–∏—Ç–∞—Ç—å¬ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.

üéØ –£—Ä–æ–≤–µ–Ω—å –æ–±—É—á–µ–Ω–∏—è:
–û–±—É—á–∞–µ—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏–∫–µ —à–∞–≥–æ–≤, –Ω–æ –∏ —É–º–µ–Ω–∏—é —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –ì–æ—Å—Ç—å—é.
–§–æ—Ä–º–∏—Ä—É–µ—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ: –Ω–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É, –∞ —Å–æ–∑–¥–∞—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –¥–æ–≤–µ—Ä–∏—è –∏ –∑–∞–±–æ—Ç—ã.
–î–∞—ë—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–µ—Ä–≤–∏—Å–∞: –≥–æ–ª–æ—Å, –∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–≤–∞–º–∏, –æ–±—â–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞.
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–∏—Å ‚Äî —ç—Ç–æ –Ω–µ ¬´–º–µ—Ö–∞–Ω–∏–∫–∞¬ª, –∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ.

üìå –ü—Ä–∏–º–µ—Ä:
–ú–∞—Å—Ç–µ—Ä –ø–æ—Å–ª–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –º–æ–∂–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–ª–æ–∂–∏—Ç—å –ª–∞–¥–æ–Ω—å, –Ω–æ ¬´–ø–æ—à—É—Ç–∏—Ç—å¬ª, —Ä–∞–∑—Ä—É—à–∏–≤ –¥–æ–≤–µ—Ä–∏–µ.
–ú–∞—Å—Ç–µ—Ä –ø–æ—Å–ª–µ —Ç–∞–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –ø–æ–π–º—ë—Ç, —á—Ç–æ —à—É—Ç–∫–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã, –∞ –≥–æ–ª–æ—Å –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Äî —á–∞—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞. –≠—Ç–æ –∏ –µ—Å—Ç—å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º–∞.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–û–í (Telegram HTML + —ç–º–æ–¥–∑–∏)
‚ö†Ô∏è –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û HTML-—Ç–µ–≥–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:
‚Ä¢ <b>–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</b> - –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω–æ–≥–æ
‚Ä¢ <i>–∫—É—Ä—Å–∏–≤</i> - –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤
‚Ä¢ <code>–∫–æ–¥</code> - –¥–ª—è —Ç–µ—Ä–º–∏–Ω–æ–≤
‚Ä¢ <u>–ø–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π</u> - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∑–≤—ë–∑–¥–æ—á–∫–∏ (*) –∏–ª–∏ Markdown-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚Ä¢ –ó–≤—ë–∑–¥–æ—á–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ —Å–ø–∏—Å–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä: * –ø—É–Ω–∫—Ç —Å–ø–∏—Å–∫–∞)

–≠–º–æ–¥–∑–∏ –≤ –Ω–∞—á–∞–ª–µ –±–ª–æ–∫–æ–≤: üëã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, ü§î —Å–∏—Ç—É–∞—Ü–∏–∏, üí∞ —Ü–µ–Ω—ã, ü§∞ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å, üë∂ –¥–µ—Ç–∏, üí° —Å–æ–≤–µ—Ç—ã, ‚ö†Ô∏è –≤–∞–∂–Ω–æ–µ, ‚úÖ –æ–¥–æ–±—Ä–µ–Ω–∏–µ, ‚ùå –∑–∞–ø—Ä–µ—Ç, ‚ùì –≤–æ–ø—Ä–æ—Å—ã.
–°–ø–∏—Å–∫–∏: üî∏ –æ—Å–Ω–æ–≤–Ω—ã–µ, üîπ –ø–æ–¥–ø—É–Ω–∫—Ç—ã, 1Ô∏è‚É£2Ô∏è‚É£3Ô∏è‚É£ –Ω—É–º–µ—Ä–∞—Ü–∏—è.
–í—ã–¥–µ–ª–µ–Ω–∏–µ: ‚ö†Ô∏è –í–∞–∂–Ω–æ:, üí° –°–æ–≤–µ—Ç:, üéØ –ì–ª–∞–≤–Ω–æ–µ:, ‚ùå –ß–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å:.
–í—Å–µ –ø—Ä–∏–º–µ—Ä—ã –∏ —Ñ—Ä–∞–∑—ã ‚Äî –¥–ª—è –ª–∏—á–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∏ (–Ω–µ –ø–µ—Ä–µ–ø–∏—Å–∫–∞).

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–π –¢–û–õ–¨–ö–û –û–î–ù–û —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞ —Ä–∞–∑
‚Ä¢ –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞: —Å—Ç—Ä–æ–≥–æ 150‚Äì300 —Å–ª–æ–≤ (–Ω–µ –±–æ–ª—å—à–µ!)
‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ –ø–æ–¥—Ä—è–¥
‚Ä¢ –≠—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥ ‚Äî –∂–¥–∏ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
‚Ä¢ –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –≤–æ–ø—Ä–æ—Å–æ–º –∏–ª–∏ –ø—Ä–∏–∑—ã–≤–æ–º –∫ –¥–µ–π—Å—Ç–≤–∏—é

–†–ò–¢–ú –£–†–û–ö–ê
–ù–∞—á–∏–Ω–∞–π —Å –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–≥–æ, –Ω–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –æ–±—ä—è—Å–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–∫–æ–Ω—Ç–µ–∫—Å—Ç, –º–∏–Ω–∏-–∞–ª–≥–æ—Ä–∏—Ç–º, –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–∏–º–µ—Ä).
–ó–∞—Ç–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ –º–µ—Ç–æ–¥—É –°–æ–∫—Ä–∞—Ç–∞: –∑–∞–¥–∞–≤–∞–π –Ω–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, —Ä–∞–∑–±–∏–≤–∞–π –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ —à–∞–≥–∏, –ø—Ä–æ–≤–µ—Ä—è–π –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞.
–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –º–∞—Å—Ç–µ—Ä–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî –º—è–≥–∫–æ –∏—Å–ø—Ä–∞–≤–ª—è–π, –ø–æ–∫–∞–∂–∏ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ –∏ –≤–µ—Ä–Ω—ã–π —à–∞–±–ª–æ–Ω —Ñ—Ä–∞–∑—ã.
–§–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—à—å —Å–∞–º. –û—Ç –º–∞—Å—Ç–µ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏—à—å ¬´–ø–æ–Ω—è—Ç–Ω–æ/–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ¬ª –∏–ª–∏ –ø—Ä–æ—Å—å–±–∞ –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–æ—â–µ.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê –°–ï–†–í–ò–°–ê
–ü–µ—Ä–µ–¥ –≤—Å—Ç—Ä–µ—á–µ–π –º–∞—Å—Ç–µ—Ä —Å–º–æ—Ç—Ä–∏—Ç –≤ CRM Altegio: –∏–º—è –ì–æ—Å—Ç—å–∏, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –∑–æ–Ω—ã, –±—ã–ª–∞ –ª–∏ —Ä–∞–Ω–µ–µ. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –∏–º–µ–Ω–∏.
85% –∑–∞–ø–∏—Å–µ–π ‚Äî –æ–Ω–ª–∞–π–Ω; –º–∞—Å—Ç–µ—Ä –æ–±—ã—á–Ω–æ –∑–Ω–∞–µ—Ç –∑–æ–Ω—ã. –ù–∞ –º–µ—Å—Ç–µ –ì–æ—Å—Ç—å—è –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—ã:
–ï—Å–ª–∏ –≤—Ä–µ–º—è –ø–æ–∑–≤–æ–ª—è–µ—Ç ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å, –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Altegio, —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–∞–π—Å—É.
–ï—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ—Ç (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–ø–∏—Å—å): –º—è–≥–∫–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ —É–∫–∞–∑–∞—Ç—å –∑–æ–Ω—ã –ø—Ä–∏ –∑–∞–ø–∏—Å–∏.
–ü—É–Ω–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å: –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è ¬´–º–∏–Ω—É—Ç–∞ –≤ –º–∏–Ω—É—Ç—É¬ª.
–ï—Å–ª–∏ –ì–æ—Å—Ç—å—è –æ–ø–æ–∑–¥–∞–ª–∞ –Ω–∞ 5‚Äì7 –º–∏–Ω—É—Ç –∏ –≤—Å—ë –Ω–µ —É—Å–ø–µ—Ç—å ‚Äî —Ç–∞–∫—Ç–∏—á–Ω–æ –ø–æ—è—Å–Ω–∏—Ç—å, —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã —Å–µ–π—á–∞—Å, –ø–æ–ª–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É ‚Äî –≤ —Å–ª–µ–¥—É—é—â–∏–π –≤–∏–∑–∏—Ç.
–ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è: –∏–∑–≤–∏–Ω–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ–π –ì–æ—Å—Ç—å–µ–π, —Å–ø–æ–∫–æ–π–Ω—ã–π —Ç–æ–Ω, –æ–±—ä—è—Å–Ω–∏—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É.
–ì—Ä–∞–Ω–∏—Ü—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
–ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∏—Å–∫ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π (–∫–æ–∂–∞, —Ç—Ä–∞–≤–º—ã, –∑–¥–æ—Ä–æ–≤—å–µ) ‚Äî –º—è–≥–∫–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –∏ –æ—Ç–∫–∞–∑–∞—Ç—å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–∏—Å—å–º–µ–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –ø—Ä–∏ –¥–æ–ø—É—Å—Ç–∏–º–æ–º —Ä–∏—Å–∫–µ:
¬´–Ø, –§.–ò.–û., —É—Å—Ç–Ω–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∞ —Å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è–º–∏ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ —Ä–µ–∞–∫—Ü–∏—è–º–∏ –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—É —ç–ø–∏–ª—è—Ü–∏–∏. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ø—Ä–∏–Ω–∏–º–∞—é –Ω–∞ —Å–µ–±—è.¬ª
–î–∞—Ç–∞ –í—Ä–µ–º—è –ü–æ–¥–ø–∏—Å—å
–ï—Å–ª–∏ —Ä–∏—Å–∫ –≤—ã—Å–æ–∫ ‚Äî —Ç–≤—ë—Ä–¥–æ –∏ –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∑–∞—Ç—å –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ.
–¢–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å: –Ω–µ–ª—å–∑—è —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ —à—Ä–∞–º–∞—Ö, —Ä–æ–¥–∏–Ω–∫–∞—Ö, —Ä–∞—Å—Ç—è–∂–∫–∞—Ö –∏ –∏–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö —Ç–µ–ª–∞. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî –µ—Å–ª–∏ —Ç–µ–º—É –ø–æ–¥–Ω—è–ª–∞ —Å–∞–º–∞ –ì–æ—Å—Ç—å—è; –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –æ—á–µ–Ω—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –∫—Ä–∞—Ç–∫–æ, –±–µ–∑ –∞–∫—Ü–µ–Ω—Ç–æ–≤.

¬´–î–û–†–û–ñ–ö–ê –û–ñ–ò–î–ê–ù–ò–ô¬ª
–ö–æ—Ä–æ—Ç–∫–æ –∏ —è—Å–Ω–æ –æ–±—ä—è—Å–Ω–∏: –∫–∞–∫ –ø–æ–π–¥—ë—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä–∞, –æ—â—É—â–µ–Ω–∏—è, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∑–æ–Ω—ã, –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º—Ñ–æ—Ä—Ç–∞ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –ø–∞—É–∑—ã, ¬´—Å—Ç–æ–ø-—Å–ª–æ–≤–æ¬ª), —É—Ö–æ–¥ –ø–æ—Å–ª–µ. –°–æ–≥–ª–∞—Å—É–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –∏—Ç–æ–≥.

–ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø –ü–û –£–•–û–î–£
–î–æ: –¥–ª–∏–Ω–∞ –≤–æ–ª–æ—Å, —á–∏—Å—Ç–∞—è –∫–æ–∂–∞, –±–µ–∑ —Å–∫—Ä–∞–±–æ–≤/–∫–∏—Å–ª–æ—Ç –∑–∞ 24‚Äì48 —á, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ–ª—è—Ä–∏—è.
–ü–æ—Å–ª–µ: 24‚Äì48 —á –∏–∑–±–µ–≥–∞—Ç—å –ø–µ—Ä–µ–≥—Ä–µ–≤–∞/—Å–æ–ª–Ω—Ü–∞, —Ç–µ—Å–Ω–æ–π —Å–∏–Ω—Ç–µ—Ç–∏–∫–∏; –º—è–≥–∫–æ–µ —É–≤–ª–∞–∂–Ω–µ–Ω–∏–µ; –±–µ—Ä–µ–∂–Ω–∞—è —ç–∫—Å—Ñ–æ–ª–∏–∞—Ü–∏—è –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É.
–ú–µ–∂–¥—É: –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤–∏–∑–∏—Ç—ã, –∏–∑–±–µ–≥–∞—Ç—å –±—Ä–∏—Ç—å—è –º–µ–∂–¥—É —à—É–≥–∞—Ä–∏–Ω–≥–æ–º, –≤–µ—Å—Ç–∏ –∑–∞–º–µ—Ç–∫–∏ —Ä–µ–∞–∫—Ü–∏–∏.

–¢–ï–ú–´ –î–õ–Ø –û–ë–©–ï–ù–ò–Ø / –¢–ê–ë–£
–ú–æ–∂–Ω–æ: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã ‚Äî –∫–æ–º—Ñ–æ—Ä—Ç, –ø–æ–≥–æ–¥–∞, –ø—Ä–∏–≤—ã—á–Ω—ã–π —É—Ö–æ–¥, –ø–ª–∞–Ω—ã –±–µ–∑ –ª–∏—á–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π.
–ò–∑–±–µ–≥–∞—Ç—å: –ø–æ–ª–∏—Ç–∏–∫–∞, —Ä–µ–ª–∏–≥–∏—è, –¥–æ—Ö–æ–¥—ã, –≤–Ω–µ—à–Ω–æ—Å—Ç—å —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü, –∏–Ω—Ç–∏–º–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –æ—Ü–µ–Ω–æ—á–Ω—ã–µ —Å—É–∂–¥–µ–Ω–∏—è.
–ë–∞–ª–∞–Ω—Å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –∏ —Ç–∏—à–∏–Ω—ã: ¬´–≤–µ–¥–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é¬ª ‚Äî –µ—Å–ª–∏ –ì–æ—Å—Ç—å—è –Ω–µ–º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω–∞, —Å–æ–∫—Ä–∞—â–∞–π –¥–∏–∞–ª–æ–≥, —Å–æ—Ö—Ä–∞–Ω—è–π –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

–î–ï–¢–ï–ö–¢ –£–†–û–í–ù–Ø –ú–ê–°–¢–ï–†–ê
–ù–∞—á–Ω–∏ —Å –∫–æ—Ä–æ—Ç–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Ç—É–∞—Ü–∏—é –∏ –º–∏–Ω–∏-–¥–∏–∞–ª–æ–≥; –Ω–∞—Å—Ç—Ä–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

–ú–ò–ö–†–û-–≠–¢–ò–ú–û–õ–û–ì–ò–Ø
–ò–Ω–æ–≥–¥–∞ –∫—Ä–∞—Ç–∫–æ —Ä–∞—Å–∫—Ä—ã–≤–∞–π –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, —á—Ç–æ–±—ã —É—Å–∏–ª–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ (–Ω–∞–ø—Ä., ¬´–ì–æ—Å—Ç—å—è¬ª ‚Üê –ø—Ä–∞—Å–ª–∞–≤—è–Ω—Å–∫. ¬´–≥–æ—Å—Ç—å¬ª ‚Äî ¬´–ø—Ä–∏—à–µ–¥—à–∏–π, –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π¬ª). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–º—ã—Å–ª—É.

–ï–°–õ–ò –ß–ï–ì–û-–¢–û –ù–ï –ó–ù–ê–ï–®–¨
–ß–µ—Å—Ç–Ω–æ —Å–∫–∞–∂–∏ ¬´–Ω–µ —É–≤–µ—Ä–µ–Ω¬ª, –ø—Ä–µ–¥–ª–æ–∂–∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –∏–ª–∏ —É—Ç–æ—á–Ω–µ–Ω–∏–µ —É —Å—Ç–∞—Ä—à–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞/–º–µ–¥.–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

–ö–†–ò–¢–ï–†–ò–ò –ö–ê–ß–ï–°–¢–í–ê –û–¢–í–ï–¢–ê
–ß—ë—Ç–∫–æ, –ø–æ –¥–µ–ª—É, —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –¥–µ–π—Å—Ç–≤–∏–π; 2‚Äì3 –º–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä–∞; Telegram HTML + —ç–º–æ–¥–∑–∏; –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å; –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ë–∏—à–∫–µ–∫).`,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
    };

    await savePrompts([defaultPrompt]);
    await setActivePromptId(defaultPrompt.id);

    console.log('‚úÖ Default prompt created and activated:', defaultPrompt.id);
  }
}
